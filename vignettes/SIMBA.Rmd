---
title: "SIMBA: name"
author:
- name: Simone Tiberi
  affiliation:
  - Department of Statistical Sciences, University of Bologna, Bologna, Italy
  email: simone.tiberi@unibo.it
- name: Jordy Bollon
  affiliation: 
  - Computational Department of CMP3VDA, Aosta, Italy
  email: jordy.bollon@iit.it
package: "`r BiocStyle::pkg_ver('SIMBA')`"
date: "`r format(Sys.Date(), '%m/%d/%Y')`"
bibliography: References.bib
vignette: >
  %\VignetteIndexEntry{SIMBA}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
output: 
  BiocStyle::html_document
---

---
```{r setup, echo=FALSE, results="hide"}
knitr::opts_chunk$set(tidy=FALSE, cache=TRUE,
                      dev="png",
                      message=TRUE, error=FALSE, warning=TRUE)
```

# Introduction
*SIMBA* is a Bayesian method to perform inference on single protein isoforms.
Our approach infers the presence/absence of protein isoforms, and also estimates their abundance;
additionally, it provides a measure of the uncertainty of these estimates, via:
i) the posterior probability the a protein isoform is present in the sample;
ii) a posterior credible interval of its abundance.
SIMBA inputs liquid cromatography mass spectrometry (MS) data,
and can work with both PSM counts, and intensities.
When available, trascript isoform abundances (i.e., TPMs) are also incorporated:
TPMs are used to formulate an informative prior for the respective protein isoform relative abundance.
We further identify isoforms where the relative abundance of proteins and transcripts significantly differ.
We use a two-layer latent variable approach to model two sources of uncertainty typical of MS data:
i) peptides may be erroneously detected (even when absent);
ii) many peptides are compatible with multiple protein isoforms.
In the first layer, we sample the presence/absence of each peptide based on its estimated probability 
of being mistakenly detected, also known as PEP.
In the second layer, for peptides that were estimated as being present, 
we allocate their abundance across the protein isoforms they map to.
These two steps allow us to recover the presence and abundance of each protein isoform.

## Bioconductor installation
`SIMBA` is available on [Bioconductor](https://bioconductor.org/packages/SIMBA) and can be installed with the command:
```{r Bioconductor_installation, eval=FALSE}
if (!requireNamespace("BiocManager", quietly=TRUE))
  install.packages("BiocManager")
BiocManager::install("SIMBA")
```

To access the R code used in the vignettes, type:
```{r vignettes, eval=FALSE} 
browseVignettes("SIMBA")
```

# Questions, issues and citation

Questions relative to *SIMBA* should be reported as a new issue at *[BugReports](https://github.com/SimoneTiberi/SIMBA/issues)*.

To cite *SIMBA*, type:
```{r citation} 
citation("SIMBA")
```

# Load the package
Load *SIMBA*.
```{r load, message=FALSE}
library(SIMBA)
```

# Input data
The input data of SIMBA must be loaded and preprocessed by using the \code{load_data} function. The data to be imputed can be generated by
Metamorpheus Tool, OpenMS Toolkit or other tool if the data is structured as specificed in the section pippo.
Here, we use a small dataset created by MetaMorpheus.

The scripts to generate this data can be found [here](?come mettere link a inst/script). To create input file using OpenMS toolkit see pippo.

We specify the directory of the data (internal in the package).
```{r specify extdata path}
data_dir = system.file("extdata", package = "SIMBA")
```

## From MetaMorpheus Tool
Define the path to the AllPeptides.psmtsv file returned by MetaMorpheus tool
```{r set path MM psm}
path_to_peptides_psm = paste0(data_dir, "/AllPeptides.psmtsv")
```

### PSM counts
The AllPeptides.psmtsv file contains all the information required to run SIMBA with PSM counts. To load the file run:
```{r load psm}
data_loaded = load_data(path_to_peptides_psm = path_to_peptides_psm)
```

### Intensities
If we want to run the algorithm with peptides intensities, we need to specify a second file generated by MM: "AllQuantifiedPeptides.tsv".
Then, we have to set abundance_type argument to "intensities" (otherwise by default the \code{load_data} function will preprocess psm counts).
```{r set path MM intensities}
path_to_peptides_intensities = paste0(data_dir, "AllQuantifiedPeptides.tsv")
data_loaded = load_data(path_to_peptides_psm = path_to_peptides_psm,
                        path_to_peptides_intensities = path_to_peptides_intensities)
```

## From OpenMS Toolkit

## From user data

## mRNA data integration

## FDR threshold

## PEP option

# Run SIMBA algorithm

## Setting the prior

## Parallel computation

# Plotting the results

# Session info
```{r sessionInfo}
sessionInfo()
```

# References
